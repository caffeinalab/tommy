# Tommy: Web Assets converter and optimizer

Tommy will process and optimize all your static assets ready for the web no matter what is the file extensions.

It will cache yet processed files so that future executions will be fast.

You can optionally configure Tommy to upload all your processed assets to a S3 bucket.

## Handled files

- _Image files_ will be optimized, then resized in multiple images using `imagemagick`
- _Video files_ will be converted to `mp4, webm` using `ffmpeg` and a poster image will be extracted
- _All other static assets_ will be just copied and remain untouched

More specifically:

- `jpg, jpeg` will be converted with `imagemagick` and optimized with `jpegoptim`
- `png` will be converted with `imagemagick` and optimized with `pngquant`
- `gif` will be optimized with `gifsicle`
- `svg` will be optimized with `svgo`

## Configuration

If you pass to Tommy an additional JSON file, it will be merged with initial config.

```sh
tommy --config config.json
```

Example:

```json
{
  "version": "v1",
  "resize": [200, 400, 800],
  "ignore": [".DS_Store", ".gitignore"]
}
```

### `version`

Specify a version of the configuration.
If this value changes, all assets will be regenerated.

### `resize`

Array of dimensions in PX that specify the images that will be
generated by resizing along longest side.

### `ignore`

Array of file names to ignore.

### `remoteSync`

Boolean value indicating that a remote sync should occur (default: `false`)

### `s3Bucket`

The name of the S3 bucket to sync from/to.

## Confuring AWS credentials

To use the _remote sync_ feature, you need to configure the binary `aws` to locale credentials.

When using with docker, you can just share your `.awscredentials` file through a volume in the path `/root/.aws/credentials`.

Otherwise, you can configure your `aws` via `aws configure`.

Example file:

````txt
[default]
aws_access_key_id=...
aws_secret_access_key=...
```

To mount:

```sh
docker run
...
-v "$(pwd)/.awscredentials":"/root/.aws/credentials"
...
```

## How to: run with Docker

```sh
docker run \
-v "$(pwd)/volumes/src":/src \
-v "$(pwd)/volumes/dst":/dst \
-v "$(pwd)/config.json:/config.json" \
kopiro/tommy \
--src /src \
--dst /dst \
--config /config.json
````

## How to: run in MacOS

Upfront, install dependencies by running `macos.sh`, then install with NPM:

```sh
npm -g i tommy
```

Then run as a binary:

```sh
tommy --src ./volumes/src --dst ./volumes/dst
```

## License

MIT
